<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="scheduleStyle.css">
    <meta charset="UTF-8">
    <title>расписание</title>
</head>

<body>
<h1>Schedule</h1>
<div class="topnav">
    <a>тут будет красивое....</a>
</div>

<table id="schedule">
    <thead>
    <th></th>
    <th:block th:each="days : ${defaultDays}">
        <th th:text="${days}"></th>
    </th:block>
    </thead>


    <tr th:each="iterPar, iterStat: ${defaultTimes}">
        <th:block>
            <td th:text="${iterPar}"></td> <!--ячейка со временем -->
            <td th:each="subjPar: ${defaultScheduleItems}" th:text="${subjPar[iterStat.index]}"></td>
            <!-- выводим строку с названием предмета, соответствующую данному времени и дню -->
        </th:block>
    </tr>

</table>
<div>
    <button id="editButton">Редактировать</button>
    <button id="saveButton">Сохранить изменения</button>
</div>


<script>
    function editButtonClick() {
        const table = document.getElementById("schedule");
        let currCell;
        for (let i = 1; i < table.rows.length; i++) {
            for (let j = 0; j < table.rows[0].cells.length; j++) {
                currCell = table.rows[i].cells[j];
                const form = document.createElement("form");
                form.action = "";
                form.method = "put";
                const input = document.createElement("input");
                input.type = "text";
                input.value = currCell.innerHTML;
                form.appendChild(input);
                currCell.innerHTML = "";
                currCell.appendChild(form);
            }
        }
    }

    function saveButtonClick() {
        const table = document.getElementById("schedule");
        let schedule = []; //сюда плюхнуть scheduleId
        const scheduleId = 1;
        schedule.push(scheduleId);
        let scheduleDays = [];
        // {
                // "scheduleId" : 1...
                // "scheduleDays" : [ - сейчас будем задавать:

        const columnsAmount = table.rows[0].length;
        //идем по столбцам, чтобы присваивать dayId в каждый день
        for (let dayColumn = 0; dayColumn < columnsAmount; dayColumn++) {
            //пришли в столбец, идем по его строкам:
            for (let i = 1; i < table.rows.length; i++) {
                let scheduleDay = {
                    dayId: dayColumn,
                    scheduleId: 1,
                    subjects: []
                };
                //идем по ячейкам только этого столбца
                for (let j = 0; j < table.rows[0].cells.length; j++) {
                    let cell = table.rows[i].cells[dayColumn];
                    let timeCell = table.rows[i].cells[0];

                    // сабжект айди задается временем (0 колонка, нынешняя строка i) и
                    // связаным scheduleDay и его дэй айди (dayColumn)
                    let subjectId = {
                        time: timeCell.innerHTML.trim(),
                        dayId: dayColumn
                    }

                    //получаем содержимое нынешней ячейки...
                    let content = cell.innerHTML.trim();

                    //и добавляем его в сабджект
                    let subject = {
                        subjectId: subjectId,
                        content: content
                    };

                    //полученные сабджектс добавляем в сабджектс дня
                    scheduleDay.subjects.push(subject);
                }
                //к дням расписания добавляем только что инициализированный день
                scheduleDays.push(scheduleDay);
            }
    }
        //после того, как прошли все дни, полученный массив scheduleDays добавляем в schedule:
        schedule.push(scheduleDays);

        fetch('http://localhost:8080', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(schedule)
        })
            .then(response => console.log(response.status));
    }

    document.getElementById('editButton').addEventListener('click', editButtonClick);
    document.getElementById('saveButton').addEventListener('click', saveButtonClick);


</script>
</body>
</html>